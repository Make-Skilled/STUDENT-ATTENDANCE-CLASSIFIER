<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Attendance Predictor - Prediction</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            padding: 20px;
        }
        .prediction-card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-top: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .result-section {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
        }
        .present {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
        }
        .absent {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
        }
        .late {
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
        <div class="container">
            <a class="navbar-brand" href="/">Student Attendance Predictor</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/#features">Features</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/#how-it-works">How It Works</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/predict">Predict</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <h1 class="text-center mb-4">Predict Student Attendance</h1>
        
        <div class="row">
            <div class="col-md-6">
                <div class="prediction-card">
                    <h3>Input Data</h3>
                    <form id="predictionForm">
                        <div class="form-group">
                            <label for="health_status">Health Status</label>
                            <select class="form-control" id="health_status" name="health_status" required>
                                <option value="Good">Good</option>
                                <option value="Fair">Fair</option>
                                <option value="Poor">Poor</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="transportation_mode">Transportation Mode</label>
                            <select class="form-control" id="transportation_mode" name="transportation_mode" required>
                                <option value="Bus">Bus</option>
                                <option value="Car">Car</option>
                                <option value="Walking">Walking</option>
                                <option value="Bicycle">Bicycle</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="previous_attendance">Previous Attendance (%)</label>
                            <input type="number" class="form-control" id="previous_attendance" name="previous_attendance" 
                                   min="0" max="100" step="1" required>
                        </div>

                        <div class="form-group">
                            <label for="study_hours">Study Hours (per day)</label>
                            <input type="number" class="form-control" id="study_hours" name="study_hours" 
                                   min="0" max="24" step="0.5" required>
                        </div>

                        <div class="form-group">
                            <label for="sleep_hours">Sleep Hours</label>
                            <input type="number" class="form-control" id="sleep_hours" name="sleep_hours" 
                                   min="0" max="24" step="0.5" required>
                        </div>

                        <button type="submit" class="btn btn-primary w-100">Predict Attendance</button>
                    </form>
                </div>
            </div>

            <div class="col-md-6">
                <div class="prediction-card">
                    <h3>Prediction Result</h3>
                    <div id="result" class="result-section" style="display: none;">
                        <h4>Prediction: <span id="prediction"></span></h4>
                        <div class="mt-3">
                            <h5>Probabilities:</h5>
                            <div class="progress mb-2">
                                <div id="presentProb" class="progress-bar bg-success" role="progressbar"></div>
                            </div>
                            <div class="progress mb-2">
                                <div id="absentProb" class="progress-bar bg-danger" role="progressbar"></div>
                            </div>
                            <div class="progress mb-2">
                                <div id="lateProb" class="progress-bar bg-warning" role="progressbar"></div>
                            </div>
                        </div>
                        <div id="riskFactors" class="mt-3">
                            <h5>Risk Factors:</h5>
                            <ul id="riskFactorsList"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('predictionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Convert percentage to decimal
            const previousAttendance = document.getElementById('previous_attendance').value / 100;
            const studyHours = document.getElementById('study_hours').value / 24;
            const sleepHours = document.getElementById('sleep_hours').value / 24;

            const data = {
                health_status: document.getElementById('health_status').value,
                transportation_mode: document.getElementById('transportation_mode').value,
                previous_attendance: previousAttendance,
                study_hours: studyHours,
                sleep_hours: sleepHours,
                // Default values for other required fields
                family_support: "High",
                extracurricular_activities: "Yes",
                internet_access: "Yes",
                class_time: "Morning",
                subject_difficulty: "Medium",
                family_income_level: "Middle",
                previous_grades: 0.75,
                distance: 0.3,
                previous_absence_count: 0.2
            };

            try {
                const response = await fetch('/api/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('result').style.display = 'block';
                    document.getElementById('prediction').textContent = result.prediction;
                    
                    // Update probability bars
                    document.getElementById('presentProb').style.width = (result.probabilities.Present * 100) + '%';
                    document.getElementById('presentProb').textContent = 'Present: ' + (result.probabilities.Present * 100).toFixed(1) + '%';
                    
                    document.getElementById('absentProb').style.width = (result.probabilities.Absent * 100) + '%';
                    document.getElementById('absentProb').textContent = 'Absent: ' + (result.probabilities.Absent * 100).toFixed(1) + '%';
                    
                    document.getElementById('lateProb').style.width = (result.probabilities.Late * 100) + '%';
                    document.getElementById('lateProb').textContent = 'Late: ' + (result.probabilities.Late * 100).toFixed(1) + '%';

                    // Update risk factors
                    const riskList = document.getElementById('riskFactorsList');
                    riskList.innerHTML = '';
                    result.risk_factors.forEach(factor => {
                        const li = document.createElement('li');
                        li.textContent = factor;
                        riskList.appendChild(li);
                    });

                    // Add appropriate class based on prediction
                    const resultDiv = document.getElementById('result');
                    resultDiv.className = 'result-section';
                    if (result.prediction === 'Present') {
                        resultDiv.classList.add('present');
                    } else if (result.prediction === 'Absent') {
                        resultDiv.classList.add('absent');
                    } else {
                        resultDiv.classList.add('late');
                    }
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        });
    </script>
</body>
</html> 